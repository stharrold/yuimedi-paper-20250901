# Example GitHub Actions workflow demonstrating secrets management
# This is a reference/template - customize for your actual workflows
#
# Security note: This workflow only uses secrets.* references which are secure.
# It does not use any user-controlled inputs in run commands.

name: Secrets Example

on:
  workflow_dispatch:  # Manual trigger only (this is just an example)

jobs:
  test-with-secrets:
    runs-on: ubuntu-latest

    env:
      # Map GitHub repository secrets to environment variables
      # These are automatically detected by scripts/run.py
      DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
      API_KEY: ${{ secrets.API_KEY }}
      # Optional secrets - run.py warns but continues if missing
      ANALYTICS_TOKEN: ${{ secrets.ANALYTICS_TOKEN }}

    steps:
      - uses: actions/checkout@v4

      - name: Install uv
        uses: astral-sh/setup-uv@v4

      - name: Run tests with secrets
        run: uv run scripts/run.py uv run pytest

      - name: Verify secrets loaded
        run: uv run scripts/run.py python -c "print('Secrets injected successfully')"

  # Alternative: Use job-level environment
  test-with-environment:
    runs-on: ubuntu-latest
    environment: production  # GitHub environment with secrets

    env:
      DB_PASSWORD: ${{ secrets.DB_PASSWORD }}
      API_KEY: ${{ secrets.API_KEY }}

    steps:
      - uses: actions/checkout@v4
      - uses: astral-sh/setup-uv@v4
      - run: uv run scripts/run.py uv run pytest
