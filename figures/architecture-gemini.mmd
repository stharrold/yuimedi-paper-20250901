%% 1. User Interaction Layer
subgraph UI_Layer ["User Interaction Layer"]
    direction TB
    ClinicalUser(["ðŸ‘¤ Clinical User"])
    NL_Query[/"ðŸ“„ Natural Language Query"\]
    ConvAI["ðŸ¤– Conversational AI Interface"]
end

%% 2. Knowledge Support Layer
subgraph Knowledge_Layer ["Knowledge Support Infrastructure"]
    direction TB
    OrgMem[("Organizational Memory")]
    BestPrac[("Best Practices Repository")]
    InstKB[("Institutional Knowledge Base")]
    Ontologies["ðŸ“š Healthcare Ontologies"]

    OrgMem -->|"Feeds"| InstKB
    BestPrac -->|"Feeds"| InstKB
end

%% 3. Core Processing Engine
subgraph Engine_Layer ["Analytics Processing Core"]
    direction TB
    NLP_Engine["âš™ï¸ Healthcare NLP Engine"]
    SQL_Gen["ðŸ“ Context-Aware SQL Generation"]
end

%% 4. Data Layer
HealthDW[("ðŸ—„ï¸ Healthcare Data Warehouse")]

%% 5. Output Layer
subgraph Insight_Layer ["Insight Delivery"]
    direction TB
    Intel_Response["âš¡ Intelligent Response Generation"]
    Visuals["ðŸ“Š Contextual Insights & Visualizations"]
end

%% --- Relationships and Flow ---

%% Input Flow
ClinicalUser -->|"1. Initiates"| NL_Query
NL_Query -->|"2. Transmits"| ConvAI
ConvAI -->|"3. Connects to"| NLP_Engine

%% Knowledge Injection
InstKB -.->|"Provides Context"| NLP_Engine
Ontologies -.->|"Provides Semantics"| NLP_Engine

%% Processing
NLP_Engine -->|"4. Interprets & Feeds"| SQL_Gen
SQL_Gen -->|"5. Queries"| HealthDW

%% Data Return
HealthDW -->|"6. Returns Data"| Intel_Response

%% Output Generation
Intel_Response -->|"7. Processes"| Visuals
Visuals -->|"8. Feedback Loop"| ClinicalUser

%% Class Assignments
class ClinicalUser,NL_Query input;
class OrgMem,BestPrac,InstKB,HealthDW database;
class UI_Layer,Knowledge_Layer,Engine_Layer,Insight_Layer container;
