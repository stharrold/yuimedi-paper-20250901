%%{init: {'theme': 'base', 'themeVariables': { 'primaryColor': '#e8f4f8', 'primaryTextColor': '#1a1a1a', 'primaryBorderColor': '#2c5282', 'lineColor': '#2c5282', 'secondaryColor': '#f0fff4', 'tertiaryColor': '#fffaf0'}}}%%
flowchart TB
    subgraph CYCLE["Validated Query Cycle"]
        direction TB
        Q["1. QUERY<br/>Domain expert asks<br/>natural language question"]
        G["2. GENERATION<br/>System generates<br/>candidate SQL"]
        V["3. VALIDATION<br/>Expert confirms or<br/>corrects SQL"]
        S["4. STORAGE<br/>Validated NL+SQL pair<br/>stored in memory"]
        R["5. RETRIEVAL<br/>Future queries match<br/>validated pairs"]
        P["6. PERSISTENCE<br/>Knowledge survives<br/>staff turnover"]
    end

    subgraph PILLARS["Three-Pillar Compounding Cycle (BROKEN)"]
        direction LR
        M["Low Analytics<br/>Maturity"]
        T["Workforce<br/>Turnover"]
        B["Technical<br/>Barriers"]
    end

    Q --> G
    G --> V
    V -->|"Correct"| S
    V -->|"Incorrect"| G
    S --> R
    R --> P
    P -.->|"New expert uses<br/>validated queries"| Q

    S -.->|"Accelerates<br/>advancement"| M
    P -.->|"Preserves<br/>expertise"| T
    R -.->|"Reduces<br/>barriers"| B

    style Q fill:#e8f4f8,stroke:#2c5282,stroke-width:2px
    style G fill:#e8f4f8,stroke:#2c5282,stroke-width:2px
    style V fill:#fff3cd,stroke:#856404,stroke-width:2px
    style S fill:#d4edda,stroke:#155724,stroke-width:2px
    style R fill:#e8f4f8,stroke:#2c5282,stroke-width:2px
    style P fill:#d4edda,stroke:#155724,stroke-width:2px
    style M fill:#f8d7da,stroke:#721c24,stroke-width:1px
    style T fill:#f8d7da,stroke:#721c24,stroke-width:1px
    style B fill:#f8d7da,stroke:#721c24,stroke-width:1px
    style CYCLE fill:#ffffff,stroke:#2c5282,stroke-width:2px
    style PILLARS fill:#fff5f5,stroke:#721c24,stroke-width:2px,stroke-dasharray: 5 5
