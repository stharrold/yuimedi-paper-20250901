%%{init: {'theme': 'base', 'flowchart': {'useMaxWidth': false, 'markdownAutoWrap': false}, 'themeVariables': { 'primaryColor': '#e0e0e0', 'primaryTextColor': '#1a1a1a', 'primaryBorderColor': '#666', 'lineColor': '#4a4a4a', 'secondaryColor': '#f0f0f0', 'tertiaryColor': '#fafafa', 'fontFamily': 'Arial, sans-serif', 'fontSize': '10pt'}}}%%
flowchart TD
    %% Healthcare Analytics Architecture
    %% Updated to align with paper.md Figure 1 caption

    subgraph UI["<b>User Interaction Layer</b>"]
        A["Clinical User"] -->|"1. Initiates"| B["Natural Language Query"]
        B -->|"2. Transmits"| C["Conversational AI Interface"]
    end

    subgraph Knowledge["<b>Knowledge Infrastructure</b>"]
        D[("Organizational Memory")] -.-> G[("Institutional Knowledge Base")]
        E[("Best Practices Repository")] -.-> G
        F[("Healthcare Ontologies")]
    end

    subgraph Engine["<b>Analytics Processing Core</b>"]
        H["Healthcare NLP Engine"] -->|"4. Interprets & Feeds"| I["Context-Aware SQL Generation"]
    end

    J[("Healthcare Data Warehouse")]

    subgraph Output["<b>Insight Delivery</b>"]
        K["Intelligent Response Generation"] -->|"7. Processes"| L["Contextual Insights & Visualizations"]
    end

    %% Main flow (Solid lines)
    C -->|"3. Connects to"| H
    I <-->|"5. Queries & Refines"| J
    J -->|"6. Returns Data"| K
    L <-->|"8. Delivers Insights & Refines"| A

    %% Validation Loop (Dotted line per caption)
    I <.->|"Validation"| A

    %% Knowledge Storage (Dashed line per caption)
    I -.->|"Stores Validated Pair"| D

    %% Knowledge injection (Dashed lines)
    G -.->|"Provides Context"| H
    F -.->|"Provides Semantics"| H

    %% Styling - Grayscale
    classDef group fill:#e8e8e8,stroke:#666,stroke-width:2px
    class UI,Knowledge,Engine,Output group
